"0","# XGBoost model (workflow) từ script 06 sử dụng engine ""xgboost"""
"0",""
"0","# Cách 1: Dùng vip (khuyến nghị)"
"0","# vip_xgb <- vip(model_xgb_tuned, num_features = 20, geom = ""col"", aesthetics = list(fill = ""salmon"")) +"
"0","#   labs(title = ""Độ quan trọng của Biến - XGBoost (Tuned)"","
"0","#        subtitle = ""Dựa trên phép đo mặc định (thường là Gain cho XGBoost)"") +"
"0","#   theme_minimal()"
"0","# print(vip_xgb)"
"0",""
"0","# Cách 2: Trích xuất mô hình xgboost gốc"
"0","if (inherits(model_xgb_tuned$fit$fit$fit, ""xgb.Booster"")) {"
"0","    xgb_engine_model <- model_xgb_tuned$fit$fit$fit"
"0","    "
"0","    xgb_importance_matrix <- xgb.importance(model = xgb_engine_model)"
"0","    xgb_importance_top20 <- head(xgb_importance_matrix, 20)"
"0",""
"0","    vip_xgb_plot <- xgb.ggplot.importance(xgb_importance_top20) +"
"0","      labs(title = ""Top 20 Biến Quan trọng - XGBoost (Tuned)"","
"0","           subtitle = ""Dựa trên Gain (mặc định từ xgb.importance)"") +"
"0","      theme_minimal()"
"0","    print(vip_xgb_plot)"
"0","    "
"0","    ggsave(paste0(RESULTS_DIR, ""feature_importance/xgb_feature_importance_final.png""), plot = vip_xgb_plot, width = 10, height = 8)"
"0","    cat(""Đã lưu biểu đồ độ quan trọng XGBoost vào thư mục results/feature_importance.\n"")"
"0","} else {"
"0","    cat(""Không thể trích xuất mô hình xgboost gốc từ workflow. Sử dụng vip() nếu có thể.\n"")"
"0","     tryCatch({"
"0","        vip_xgb_plot <- vip(model_xgb_tuned, num_features = 20, geom = ""col"", aesthetics = list(fill = ""salmon"")) +"
"0","          labs(title = ""Độ quan trọng của Biến - XGBoost (Tuned)"","
"0","               subtitle = ""Mặc định từ vip()"") +"
"0","          theme_minimal()"
"0","        print(vip_xgb_plot)"
"0","        ggsave(paste0(RESULTS_DIR, ""feature_importance/xgb_feature_importance_final.png""), plot = vip_xgb_plot, width = 10, height = 8)"
"0","        cat(""Đã lưu biểu đồ độ quan trọng XGBoost (từ vip) vào thư mục results/feature_importance.\n"")"
"0","    }, error = function(e) {"
"0","        cat(""Lỗi khi tạo biểu đồ vip cho XGBoost:"", conditionMessage(e), ""\n"")"
"0","    })"
"0","}"
"1","Đã lưu biểu đồ độ quan trọng XGBoost vào thư mục results/feature_importance.
"
